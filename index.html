<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-primary: var(--tg-theme-button-color, #248bcf);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-sec-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }
        body { font-family: sans-serif; background: var(--tg-bg); color: var(--tg-text); margin: 0; padding: 15px; }
        
        /* –°–ø—ñ–ª—å–Ω–∏–π –¥–æ–≤—ñ–¥–Ω–∏–∫ –∑–≤–µ—Ä—Ö—É */
        .master-section {
            background: var(--tg-sec-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--tg-hint);
        }
        .master-section label { font-weight: bold; font-size: 14px; display: block; margin-bottom: 5px; }

        /* –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –≤–∫–ª–∞–¥–æ–∫ */
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; }
        .tab-btn { 
            padding: 10px 15px; border-radius: 20px; border: 1px solid var(--tg-primary);
            background: none; color: var(--tg-primary); cursor: pointer; white-space: nowrap; font-size: 12px;
        }
        .tab-btn.active { background: var(--tg-primary); color: white; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content { display: none; background: var(--tg-bg); border: 1px solid var(--tg-hint); padding: 15px; border-radius: 12px; }
        .tab-content.active { display: block; }

        select, input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid var(--tg-hint); background: var(--tg-bg); color: var(--tg-text); box-sizing: border-box; }
        button.submit-btn { width: 100%; padding: 15px; background: var(--tg-primary); color: white; border: none; border-radius: 10px; font-weight: bold; margin-top: 10px; }
        
        h3 { margin-top: 0; color: var(--tg-primary); }
    </style>
</head>
<body>

    <div class="master-section">
        <label>üìç –û–±–µ—Ä—ñ—Ç—å –æ–±'—î–∫—Ç (–°–ø—ñ–ª—å–Ω–∏–π –¥–ª—è –≤—Å—ñ—Ö):</label>
        <select id="masterDropdown">
            <option>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–¥–Ω–∏–∫–∞...</option>
        </select>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTab(1)">üöö –õ–æ–≥—ñ—Å—Ç–∏–∫–∞</button>
        <button class="tab-btn" onclick="showTab(2)">üí∞ –§—ñ–Ω–∞–Ω—Å–∏</button>
        <button class="tab-btn" onclick="showTab(3)">üì¶ –°–∫–ª–∞–¥</button>
        <button class="tab-btn" onclick="showTab(4)">üìù –ù–æ—Ç–∞—Ç–∫–∏</button>
    </div>

    <div id="tab1" class="tab-content active">
        <h3>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ñ –¥–∞–Ω—ñ</h3>
        <input type="text" id="t1_num" placeholder="–ù–æ–º–µ—Ä –∞–≤—Ç–æ">
        <input type="text" id="t1_driver" placeholder="–ü–Ü–ë –≤–æ–¥—ñ—è">
        <button class="submit-btn" onclick="sendForm(1, ['t1_num', 't1_driver'])">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ –ö–Ω–∏–≥—É 1</button>
    </div>

    <div id="tab2" class="tab-content">
        <h3>–ö–∞—Å–æ–≤–∏–π –∑–≤—ñ—Ç</h3>
        <input type="number" id="t2_amount" placeholder="–°—É–º–∞ –≥—Ä–Ω">
        <select id="t2_type"><option>–ü—Ä–∏—Ö—ñ–¥</option><option>–†–æ–∑—Ö—ñ–¥</option></select>
        <button class="submit-btn" onclick="sendForm(2, ['t2_amount', 't2_type'])">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ –ö–Ω–∏–≥—É 2</button>
    </div>

    <div id="tab3" class="tab-content">
        <h3>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è</h3>
        <input type="text" id="t3_item" placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É">
        <input type="number" id="t3_qty" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å">
        <button class="submit-btn" onclick="sendForm(3, ['t3_item', 't3_qty'])">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ –ö–Ω–∏–≥—É 3</button>
    </div>

    <div id="tab4" class="tab-content">
        <h3>–í—ñ–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h3>
        <textarea id="t4_text" rows="4" placeholder="–û–ø–∏—à—ñ—Ç—å —Å–∏—Ç—É–∞—Ü—ñ—é..."></textarea>
        <button class="submit-btn" onclick="sendForm(4, ['t4_text'])">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ –ö–Ω–∏–≥—É 4</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        const API_URL = "https://script.google.com/macros/s/AKfycbzxDFj2749Ca7TsWUS2AOzXdoDe8CoAN8pKrzndHYLU_I_C54pza69P-MwlG2yKvNpNdg/exec";

        // 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–¥–Ω–∏–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ (—Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑)
        window.onload = function() {
            fetch(API_URL)
                .then(res => res.json())
                .then(list => {
                    const master = document.getElementById('masterDropdown');
                    master.innerHTML = "";
                    list.forEach(item => {
                        let opt = document.createElement('option');
                        opt.value = item;
                        opt.textContent = item;
                        master.appendChild(opt);
                    });
                });
        };

        function showTab(num) {
            document.querySelectorAll('.tab-content, .tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab' + num).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function sendForm(tabIndex, fieldIds) {
            const masterVal = document.getElementById('masterDropdown').value;
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ —Ç—ñ–ª—å–∫–∏ –∑ –ø–æ–ª—ñ–≤ –ø–æ—Ç–æ—á–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏
            const extraData = fieldIds.map(id => document.getElementById(id).value);

            if (extraData.some(v => v === "")) {
                tg.showAlert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è –≤–∫–ª–∞–¥–∫–∏!");
                return;
            }

            tg.MainButton.setText("–ù–∞–¥—Å–∏–ª–∞—é —É –ö–Ω–∏–≥—É " + tabIndex).show();

            const payload = {
                tabIndex: tabIndex,
                masterValue: masterVal,
                extraData: extraData,
                tg_id: tg.initDataUnsafe?.user?.id || "N/A",
                tg_name: tg.initDataUnsafe?.user?.first_name || "Guest"
            };

            fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(payload)
            }).then(() => {
                tg.MainButton.hide();
                fieldIds.forEach(id => document.getElementById(id).value = ""); // –û—á–∏—Å—Ç–∫–∞
                tg.showAlert("–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ñ –≤ –æ–∫—Ä–µ–º—É –∫–Ω–∏–≥—É " + tabIndex);
            });
        }
    </script>
</body>
</html>
